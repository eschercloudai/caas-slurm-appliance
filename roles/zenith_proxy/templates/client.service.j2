# container-filebeat.service
# based off
#   podman generate systemd filebeat --restart-policy always --new --name
# with pid/cidfiles replaced with --sdnotify=conmon approach

[Unit]
Description=Podman container-filebeat.service
Documentation=man:podman-generate-systemd(1)
Wants=network.target
After=network-online.target

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Restart=always
ExecStart=/usr/bin/podman run \
  --network slirp4netns:cidr={{ podman_cidr }} \
  --sdnotify=conmon \
  --cgroups=no-conmon \
  --replace \
  --name {{ zenith_proxy_container_name }} \
  --restart=always \
  --security-opt label=disable \
  --detach=True \
  --volume /etc/zenith/{{ zenith_proxy_service_name }}:/etc/zenith:ro \
  --volume {{ zenith_proxy_service_name }}-ssh:/home/zenith/.ssh \
  {{ zenith_proxy_client_image }}
ExecStop=/usr/bin/podman stop --ignore {{ zenith_proxy_container_name }} -t 10
ExecStopPost=/usr/bin/podman rm --ignore -f {{ zenith_proxy_container_name }}
KillMode=none
Type=notify
NotifyAccess=all
User={{ zenith_proxy_podman_user }}
Group={{ zenith_proxy_podman_user }}
TimeoutStartSec=180

[Install]
WantedBy=multi-user.target default.target
